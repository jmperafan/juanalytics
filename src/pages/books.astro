---
import BaseLayout from '../layouts/BaseLayout.astro';
import { readContentYAML } from '../utils/yamlParser';

const content = await readContentYAML();
const books = content.books.map(book => ({
  slug: book.url.split('/').pop() || '',
  data: {
    title: book.title,
    description: book.description,
    pubDate: book.date,
    coverImage: book.thumbnail,
    amazonUrl: book.url,
    publisher: book.extra1 || '',
    coAuthors: book.extra2 ? book.extra2.split(';').map(a => a.trim()) : [],
    tags: book.tags,
  }
}));
---

<BaseLayout title="Books | Juanalytics">
  <section style="padding: 4rem 0;">
    <div class="container">
      <h1 style="margin-bottom: 2rem;">Books</h1>
      {books.length === 0 ? (
        <p style="color: var(--color-text-light); font-size: 1.1rem;">No books yet. Check back soon!</p>
      ) : (
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">
          {books.map((book) => (
            <a href={book.data.amazonUrl} target="_blank" rel="noopener noreferrer" class="card" style="padding: 0; overflow: hidden; display: flex; flex-direction: column;">
              {book.data.coverImage ? (
                <div style="width: 100%; height: 400px; background: var(--color-bg-secondary); display: flex; align-items: center; justify-content: center;">
                  <img src={book.data.coverImage} alt={book.data.title} style="height: 100%; width: auto; object-fit: contain;" />
                </div>
              ) : (
                <div style="width: 100%; height: 400px; background: var(--color-bg-secondary); display: flex; align-items: center; justify-content: center; color: var(--color-text-light);">
                  <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                  </svg>
                </div>
              )}
              <div style="padding: 1.5rem; flex: 1; display: flex; flex-direction: column;">
                <h3 style="margin-bottom: 0.75rem; font-size: 1.125rem; line-height: 1.4;">{book.data.title}</h3>
                {book.data.publisher && (
                  <p style="color: var(--color-primary); font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">{book.data.publisher}</p>
                )}
                <p style="color: var(--color-text-light); font-size: 0.875rem; margin-bottom: 0.75rem;">
                  Published: {book.data.pubDate.toISOString().split('T')[0]}
                </p>
                <p style="color: var(--color-text-light); font-size: 0.9375rem; line-height: 1.6; flex: 1; margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">{book.data.description}</p>
                {book.data.amazonUrl && (
                  <div style="margin-top: auto;">
                    <span class="button" style="display: inline-block; font-size: 0.875rem; padding: 0.5rem 1rem;">View on Amazon â†’</span>
                  </div>
                )}
              </div>
            </a>
          ))}
        </div>
      )}
    </div>
  </section>
</BaseLayout>
